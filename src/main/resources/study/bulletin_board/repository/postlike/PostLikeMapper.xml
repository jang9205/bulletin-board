<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="study.bulletin_board.repository.postlike.PostLikeMapper">
    
    <insert id="save" useGeneratedKeys="true" keyProperty="id">
        insert into post_like (member_id, post_id, like_date)
        values (#{member.id}, #{post.id}, #{likeDate})
    </insert>

    <delete id="deleteByPostAndMember">
        delete from post_like
        where post_id = #{postId} and member_id = #{memberId}
    </delete>

    <select id="findByPostAndMember" resultMap="postLikeResultMap">
        select post_like_id as postLikeId, member_id as memberId, post_id as postId, like_date as likeDate
        from post_like
        where post_id = #{postId} and member_id = #{memberId}
    </select>

    <select id="countByPost" resultType="int">
        select count(*)
        from post_like
        where post_id = #{postId}
    </select>
    
    <resultMap id="postLikeResultMap" type="study.bulletin_board.domain.PostLike">
        <id property="id" column="postLikeId"/>
        <result property="likeDate" column="likeDate"/>
        <association property="post" column="postId" javaType="study.bulletin_board.domain.Post" resultMap="postResultMap"/>
        <association property="member" column="memberId" javaType="study.bulletin_board.domain.Member" resultMap="memberResultMap"/>
    </resultMap>

    <resultMap id="postResultMap" type="study.bulletin_board.domain.Post">
        <id property="id" column="postId"/>
    </resultMap>

    <resultMap id="memberResultMap" type="study.bulletin_board.domain.Member">
        <id property="id" column="memberId"/>
    </resultMap>
</mapper>