<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{fragments/header :: header(~{::title},~{::section})}">
    <title>푸하핫</title>
</head>

<body>
<div class="container">
    <div class="row" style="margin-top: 80px;">
        <div class="col-lg-1"></div>
        <div class="col-lg-10">
            <h2>게시판</h2>
        </div>
    </div>
    <div class="row" style="margin-top: 20px;">
        <div class="col-lg-10 justify-content-center" style="margin: 0 auto;">
            <table class="table table-striped" style="table-layout: fixed">
                <thead>
                <tr>
                    <th width="10%">추천수</th>
                    <th width="10%">카테고리</th>
                    <th width="44%">제목</th>
                    <th width="21%">작성자</th>
                    <th width="15%">작성일</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="post : ${posts}">
                    <td th:text="${post.likeCount}"></td>
                    <td th:text="${post.category.category}"></td>
                    <td th:onClick="|location.href='@{/posts/{postId}(postId=${post.id})}'|" style="cursor:pointer;">
                        <span th:if="${post.picturePath != null}">
                            <img src="/img/photo_icon.png" alt="사진 아이콘" style="width: 17px; height: 17px; margin-left: 3px;">
                        </span>
                        <span th:text="${post.title}"></span>
                        <span th:if="${post.comments != null and #lists.size(post.comments) > 0}"
                              th:text="| [${#lists.size(post.comments)}] |"></span>
                    </td>
                    <td th:text="${post.member.nickname}"></td>
                    <td th:text="${post.getRelativePostDate()}"></td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>
    <div class="row" style="margin-top: 20px;">
        <div class="col-lg-12 d-flex justify-content-center align-items-center">
            <div class="col-lg-2"></div>
            <!-- Search Form and Write Button Wrapper Start -->
            <div class="d-flex justify-content-between w-100">
                <!-- Search Form Start -->
                <form th:action="@{/}" method="get" class="form-inline d-flex justify-content-center w-75">
                    <div class="form-group mr-2" style="margin-right: 15px;">
                        <select class="form-control" name="searchType">
                            <option value="postTitle">제목</option>
                            <option value="memberName">작성자</option>
                        </select>
                    </div>
                    <div class="form-group mr-2" style="margin-right: 15px;">
                        <input type="text" class="form-control" name="keyword" placeholder="검색어를 입력하세요">
                    </div>
                    <button type="submit" class="btn btn-secondary mr-2">검색</button>
                </form>
                <!-- Search Form End -->
                <a th:if="${#authorization.expression('isAuthenticated()')}"
                   th:href="@{/write/new}" class="btn btn-secondary ml-auto" style="margin-right: 110px;">글쓰기</a>
            </div>
            <!-- Search Form and Write Button Wrapper End -->
        </div>
    </div>
    <div class="row" style="margin-top: 20px;">
        <div class="col-lg-12 d-flex justify-content-center">
            <ul class="pagination">
                <li class="page-item" th:classappend="${currentPage == 1} ? 'disabled'">
                    <a class="page-link" th:href="@{|/?page=${currentPage - 1}&size=20|}">Previous</a>
                </li>
                <li class="page-item" th:each="page : ${#numbers.sequence(1, totalPages)}" th:classappend="${page == currentPage} ? 'active'">
                    <a class="page-link" th:href="@{|/?page=${page}&size=20|}" th:text="${page}"></a>
                </li>
                <li class="page-item" th:classappend="${currentPage == totalPages} ? 'disabled'">
                    <a class="page-link" th:href="@{|/?page=${currentPage + 1}&size=20|}">Next</a>
                </li>
            </ul>
        </div>
    </div>
</div>


<!-- Footer Section Begin -->
<div class="row" style="margin-bottom: 80px;"></div>
<footer th:replace="~{fragments/footer::footer}"></footer>
</body>

<!-- JavaScript 코드로 메시지 표시 -->
<script th:inline="javascript">
    var successMessage = [[${successMessage}]];
    if (successMessage) {
        alert(successMessage); // 메시지 박스로 메시지 표시
    }
</script>

<!-- JavaScript 코드로 메시지 표시 -->
<script th:inline="javascript">
    var error = [[${error}]];
    if (error) {
        alert(error); // 메시지 박스로 메시지 표시
    }
</script>

<script src="/js/bootstrap.min.js"></script>

</html>